<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<html>

<head>

<style>
@page {
size: 21cm 29.7cm;
margin-top: 1cm;
margin-bottom: 0cm;
border: 1px solid blue;
page-break-after: always;
}
div.Totalss {
    background: #f7f7f7 none repeat scroll 0 0 !important;
    padding-bottom: 20px;
    padding-right: 18px;
}
#header {
position: fixed;
left: 0px;
top: -180px;
right: 0px;
border: none
}

#footer {
position: fixed;
left: 0px;
bottom: -180px;
right: 0px;
height: 150px;
background-color: lightblue;
}
.row.horse-invoice {
    background: #f7f7f7 none repeat scroll 0 0;
    display: inherit;
    height: auto;
    margin: 50px 0;
    padding: 25px 0;
}
.row {
    /*margin-left: -15px;*/
    /*margin-right: -15px;*/
}


.clearfix::before, .clearfix::after, .dl-horizontal dd::before, .dl-horizontal dd::after, .container::before, .container::after, .container-fluid::before, .container-fluid::after, .row::before, .row::after, .form-horizontal .form-group::before, .form-horizontal .form-group::after, .btn-toolbar::before, .btn-toolbar::after, .btn-group-vertical > .btn-group::before, .btn-group-vertical > .btn-group::after, .nav::before, .nav::after, .navbar::before, .navbar::after, .navbar-header::before, .navbar-header::after, .navbar-collapse::before, .navbar-collapse::after, .pager::before, .pager::after, .panel-body::before, .panel-body::after, .modal-header::before, .modal-header::after, .modal-footer::before, .modal-footer::after {
    content: " ";
    display: table;
}
*::before, *::after {
    box-sizing: border-box;
}
.clearfix::after, .dl-horizontal dd::after, .container::after, .container-fluid::after, .row::after, .form-horizontal .form-group::after, .btn-toolbar::after, .btn-group-vertical > .btn-group::after, .nav::after, .navbar::after, .navbar-header::after, .navbar-collapse::after, .pager::after, .panel-body::after, .modal-header::after, .modal-footer::after {
    clear: both;
}
h3 strong {
    color: #651e1c;
}
.titleTable td {
    padding: 2px 10px;
}
.pull-right {
    float: right !important;
}
.invoice-details {
    background: white none repeat scroll 0 0;
    margin: 10px 18px;
    padding: 9px 12px;
}
#footer .page:after {
content: counter(page, upper-roman);
}

table {
border: solid 1px #cdcdcd
}

td {
text-align: justify;
padding: 10px;
}

td.test1 {
width: 20%
}

td.test2 {
width: 70%
}

.page-break {
page-break-before: always;
}

.col-sm-12 {
width: 100%;
}

.col-sm-6 {
width: 50%;
}
.col-sm-11 {
    width: 91.6667%;
}
.col-sm-2 {
width: 16.6667%;
}

.col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 {
min-height: 1px;
padding-left: 15px;
padding-right: 15px;
position: relative;

}
.col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 {
    float: left;
}
.col-sm-4 {
    width: 30%;
}
.col-sm-5 {
    width: 41.6667%;
}
.col-sm-8 {
    width: 60%;
}
.page-break {
    page-break-after: always;
}
label {
display: inline-block;
font-weight: bold;
margin-bottom: 5px;
max-width: 100%;
}

table {
  background-color: transparent;
}
caption {
  padding-top: 8px;
  padding-bottom: 8px;
  color: #777;
  text-align: left;
}
th {
  text-align: left;
}
.table {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
}
.table > thead > tr > th,
.table > tbody > tr > th,
.table > tfoot > tr > th,
.table > thead > tr > td,
.table > tbody > tr > td,
.table > tfoot > tr > td {
  padding: 8px;
  line-height: 1.42857143;
  vertical-align: top;
  border-top: 1px solid #ddd;
  font-size: 15px;
}
.table > thead > tr > th {
  vertical-align: bottom;
  border-bottom: 2px solid #ddd;
}
.table > caption + thead > tr:first-child > th,
.table > colgroup + thead > tr:first-child > th,
.table > thead:first-child > tr:first-child > th,
.table > caption + thead > tr:first-child > td,
.table > colgroup + thead > tr:first-child > td,
.table > thead:first-child > tr:first-child > td {
  border-top: 0;
}
.table > tbody + tbody {
  border-top: 2px solid #ddd;
}
.table .table {
  background-color: #fff;
}
.table-condensed > thead > tr > th,
.table-condensed > tbody > tr > th,
.table-condensed > tfoot > tr > th,
.table-condensed > thead > tr > td,
.table-condensed > tbody > tr > td,
.table-condensed > tfoot > tr > td {
  padding: 5px;
}
.table-bordered {
  border: 1px solid #ddd;
}
.table-bordered > thead > tr > th,
.table-bordered > tbody > tr > th,
.table-bordered > tfoot > tr > th,
.table-bordered > thead > tr > td,
.table-bordered > tbody > tr > td,
.table-bordered > tfoot > tr > td {
  border: 1px solid #ddd;
}
.table-bordered > thead > tr > th,
.table-bordered > thead > tr > td {
  border-bottom-width: 2px;
}
.table-striped > tbody > tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
.table-hover > tbody > tr:hover {
  background-color: #f5f5f5;
}
table col[class*="col-"] {
  position: static;
  display: table-column;
  float: none;
}
table td[class*="col-"],
table th[class*="col-"] {
  position: static;
  display: table-cell;
  float: none;
}
.table > thead > tr > td.active,
.table > tbody > tr > td.active,
.table > tfoot > tr > td.active,
.table > thead > tr > th.active,
.table > tbody > tr > th.active,
.table > tfoot > tr > th.active,
.table > thead > tr.active > td,
.table > tbody > tr.active > td,
.table > tfoot > tr.active > td,
.table > thead > tr.active > th,
.table > tbody > tr.active > th,
.table > tfoot > tr.active > th {
  background-color: #f5f5f5;
}
.table-hover > tbody > tr > td.active:hover,
.table-hover > tbody > tr > th.active:hover,
.table-hover > tbody > tr.active:hover > td,
.table-hover > tbody > tr:hover > .active,
.table-hover > tbody > tr.active:hover > th {
  background-color: #e8e8e8;
}
.table > thead > tr > td.success,
.table > tbody > tr > td.success,
.table > tfoot > tr > td.success,
.table > thead > tr > th.success,
.table > tbody > tr > th.success,
.table > tfoot > tr > th.success,
.table > thead > tr.success > td,
.table > tbody > tr.success > td,
.table > tfoot > tr.success > td,
.table > thead > tr.success > th,
.table > tbody > tr.success > th,
.table > tfoot > tr.success > th {
  background-color: #dff0d8;
}
.table-hover > tbody > tr > td.success:hover,
.table-hover > tbody > tr > th.success:hover,
.table-hover > tbody > tr.success:hover > td,
.table-hover > tbody > tr:hover > .success,
.table-hover > tbody > tr.success:hover > th {
  background-color: #d0e9c6;
}
.table > thead > tr > td.info,
.table > tbody > tr > td.info,
.table > tfoot > tr > td.info,
.table > thead > tr > th.info,
.table > tbody > tr > th.info,
.table > tfoot > tr > th.info,
.table > thead > tr.info > td,
.table > tbody > tr.info > td,
.table > tfoot > tr.info > td,
.table > thead > tr.info > th,
.table > tbody > tr.info > th,
.table > tfoot > tr.info > th {
  background-color: #d9edf7;
}
.table-hover > tbody > tr > td.info:hover,
.table-hover > tbody > tr > th.info:hover,
.table-hover > tbody > tr.info:hover > td,
.table-hover > tbody > tr:hover > .info,
.table-hover > tbody > tr.info:hover > th {
  background-color: #c4e3f3;
}
.table > thead > tr > td.warning,
.table > tbody > tr > td.warning,
.table > tfoot > tr > td.warning,
.table > thead > tr > th.warning,
.table > tbody > tr > th.warning,
.table > tfoot > tr > th.warning,
.table > thead > tr.warning > td,
.table > tbody > tr.warning > td,
.table > tfoot > tr.warning > td,
.table > thead > tr.warning > th,
.table > tbody > tr.warning > th,
.table > tfoot > tr.warning > th {
  background-color: #fcf8e3;
}
.table-hover > tbody > tr > td.warning:hover,
.table-hover > tbody > tr > th.warning:hover,
.table-hover > tbody > tr.warning:hover > td,
.table-hover > tbody > tr:hover > .warning,
.table-hover > tbody > tr.warning:hover > th {
  background-color: #faf2cc;
}
.table > thead > tr > td.danger,
.table > tbody > tr > td.danger,
.table > tfoot > tr > td.danger,
.table > thead > tr > th.danger,
.table > tbody > tr > th.danger,
.table > tfoot > tr > th.danger,
.table > thead > tr.danger > td,
.table > tbody > tr.danger > td,
.table > tfoot > tr.danger > td,
.table > thead > tr.danger > th,
.table > tbody > tr.danger > th,
.table > tfoot > tr.danger > th {
  background-color: #f2dede;
}
.table-hover > tbody > tr > td.danger:hover,
.table-hover > tbody > tr > th.danger:hover,
.table-hover > tbody > tr.danger:hover > td,
.table-hover > tbody > tr:hover > .danger,
.table-hover > tbody > tr.danger:hover > th {
  background-color: #ebcccc;
}
.table-responsive {
  min-height: .01%;
  overflow-x: auto;
}
.col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 {
  position: relative;
  min-height: 1px;
  padding-right: 15px;
  padding-left: 15px;
}
.col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 {
  float: left;
}
@media screen and (max-width: 767px) {
  .table-responsive {
    width: 100%;
    margin-bottom: 15px;
    overflow-y: hidden;
    -ms-overflow-style: -ms-autohiding-scrollbar;
    border: 1px solid #ddd;
  }
  .table-responsive > .table {
    margin-bottom: 0;
  }
  .table-responsive > .table > thead > tr > th,
  .table-responsive > .table > tbody > tr > th,
  .table-responsive > .table > tfoot > tr > th,
  .table-responsive > .table > thead > tr > td,
  .table-responsive > .table > tbody > tr > td,
  .table-responsive > .table > tfoot > tr > td {
    white-space: nowrap;
  }
  .table-responsive > .table-bordered {
    border: 0;
  }
  .table-responsive > .table-bordered > thead > tr > th:first-child,
  .table-responsive > .table-bordered > tbody > tr > th:first-child,
  .table-responsive > .table-bordered > tfoot > tr > th:first-child,
  .table-responsive > .table-bordered > thead > tr > td:first-child,
  .table-responsive > .table-bordered > tbody > tr > td:first-child,
  .table-responsive > .table-bordered > tfoot > tr > td:first-child {
    border-left: 0;
  }
  .table-responsive > .table-bordered > thead > tr > th:last-child,
  .table-responsive > .table-bordered > tbody > tr > th:last-child,
  .table-responsive > .table-bordered > tfoot > tr > th:last-child,
  .table-responsive > .table-bordered > thead > tr > td:last-child,
  .table-responsive > .table-bordered > tbody > tr > td:last-child,
  .table-responsive > .table-bordered > tfoot > tr > td:last-child {
    border-right: 0;
  }
  .table-responsive > .table-bordered > tbody > tr:last-child > th,
  .table-responsive > .table-bordered > tfoot > tr:last-child > th,
  .table-responsive > .table-bordered > tbody > tr:last-child > td,
  .table-responsive > .table-bordered > tfoot > tr:last-child > td {
    border-bottom: 0;
  }
}
.visible-xs {display: none;}
.border-bottom {
    border-bottom: 2px solid #b8a057;
    margin-bottom: 10px;
}
div.all-invoices {
    padding-left: 18px;
}
.Totalss td {
    font-size: 15px !important;
}
strong.brown {
    color: #001e46;
}

</style>
</head>

<body>
<div class="container">
<div class="white-box">

<div id="paid" class="tab-pane fade">
            <div class="row">
              <div class="col-sm-11">
              @if(count($collection)>0)
              <div class="row">
                <div class="col-sm-12">
                  <h2 style="text-align: center">{{getShowName($show_id)}} Horses Invoice</h2>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <h3 style="text-align: center">{{getUserNamefromid($user_id)}}</h3>
                </div>
              </div>
              @foreach($collection as $horses)
              <?php $additionalArray=array(); $CHArray=array(); $additionalExistingids=array(); 
                    $assetTotal = 0; $paid_on=$horses->paid_on; $divisionClassesInc=array();
                    $showOwner  = getShowOwnerInfo($show_id);
                  ?>
            <div class="row horse-invoice">
               <div class="invoice-details">
                  <table class="" style="width:100%">
                    <tr>
                    <td class="col-sm-5" id="all-invoices">
                       <table class="table primary-table">
                        <tbody>
                           <tr>
                              <td class="hidden-xs">Invoice No: </td>
                              <td><strong class="brown">{{getInvoiceNumber($show_id,$horses->horse_id,$horses)}}</strong></td>
                            </tr>
                            <tr>
                              @if($MS->template->category == TRAINER)
                                <td class="hidden-xs">Horse Name: </td>
                                <td><strong class="brown">{!! getHorseNameAsLink($horses->horse) !!}</strong></td>
                              @else
                                <td class="hidden-xs">Horse Name and Entry#: </td>
                              <td><strong class="brown">{!! getHorseNameAsLink($horses->horse) !!}</strong> ({{$horses->horse_reg}})</td>
                              @endif
                            </tr>
                            <tr>
                              <td class="hidden-xs">Client’s Name: </td>
                              <td><strong class="brown">{{getUserNamefromid($user_id)}}</strong></td>
                            </tr>
                            
                            @if($MS->template->category != TRAINER)
                            <tr>
                                <td class="hidden-xs">Horse USEF#: </td>
                                <td><strong class="brown">{{GetSpecificFormField($horses->horse,"USEF Number","N/A")}}</strong></td>
                              </tr>
                            <tr>
                              <td class="hidden-xs">Rider's Name and USEF#: </td>
                              <td><strong class="brown">{!! getRidersForHorse($horses->horse_id,$show_id) !!}</strong></td>
                            </tr>
                            <tr>
                              <td class="hidden-xs">Trainer Name and USEF#: </td>
                              <td><strong class="brown">{!! getTrainerForHorse($horses->horse_id,$show_id) !!}</strong></td>
                            </tr>
                            <tr>
                              <td class="hidden-xs">Owner Name and USEF#: </td>
                              <td><strong class="brown">{!! getOwnerForHorse($horses->horse_id) !!}</strong></td>
                            </tr>
                            @endif
                        </tbody>
                        </table>
                    </td>
                    <td class="col-sm-5" id="all-invoices">
                       <table class="table primary-table">
                        <tbody>
                        <tr>
                            <td class="hidden-xs">Business Name: </td>
                            <td><strong class="brown">{{(isset($showOwner))?$showOwner->business_name:''}}</strong></td>
                        </tr>
                          <tr>
                            @if($MS->template->category == TRAINER)
                              <td class="hidden-xs">Business Address: </td>    
                            @else
                              <td class="hidden-xs">Show Address: </td>  
                            @endif
                            
                            <td><strong class="brown">{{$MS->location}}</strong></td>
                          </tr>

                          <tr>
                            <td class="hidden-xs">Contact Information: </td>
                            <td><strong class="brown">{{$MS->contact_information}}</strong></td>
                          </tr>
                           @if($MS->template->category != TRAINER)  
                            <tr>
                              <td class="hidden-xs">Show Date: </td>
                              <td><strong class="brown">{{getDates($MS->date_from)}} Up To {{getDates($MS->date_to)}}</strong></td>
                            </tr>
                            @endif
                          <tr>
                            <td class="hidden-xs">{{post_value_or($m_s_fields,'ShowInfoOnInvoice','Info On Invoice')}}: </td>
                            <td><strong class="brown">{{$MS->info_on_invoice}} </strong></td>
                          </tr>
                        </tbody>
                        </table>
                    </td>
                    </tr>
                </table>
                  <br>

                    <div class="invoice-table">
                
                  @php
                   if ($invoice_status == 1) {
                      $DivisionHorses = getDivisionForHorse($horses->horse_id,$show_id,PAID,$paid_on); 
                    }else{
                      $DivisionHorses = getDivisionForHorse($horses->horse_id,$show_id,UNPAID);
                    }
                    
                    $divisionTotal= 0;
                    if (count($DivisionHorses)>0) {
                  @endphp
                  <div class="classes-title">
                      <h3>Divisions</h3>
                      <div class="rr-datatable">
                          <table id="crudTabl" class="table primary-table">
                            <thead class="hidden-xs">
                               <tr>
                                  <th>Division</th>
                                  <th>Code</th>
                                  <th>Registered</th>
                                  <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                            <?php  foreach ($DivisionHorses as $index => $class) { 
                               // $divarray = getDivisionClassCount($horses->horse_id,$show_id,$class->division_id);
                               // if (($class->total_classes != $divarray["counter"] && $class->primary_required != 1) ||  $divarray["counter"] ==0) {
                               //    $divisionClassesInc[] = $divarray["ids"];
                               // }else{
                                // $divarray = getDivisionClasses($horses->horse_id,$show_id,$class->division_id);
                                // dd($divarray);
                                 $divisionClassesInc[$index]['division_id'] = $class->division_id;
                                 $divisionClassesInc[$index]['primary_required'] = $class->primary_required;
                                 $CHArray[]=$class->classhorses->id;
                                ?>
                                <tr>
                                 <td><strong class="visible-xs">Division</strong> {{getAssetName($class->pclass)}}</td>
                                 <td><strong class="visible-xs">Code</strong> {{ GetSpecificFormField($class->pclass,"Code") }} </td>
                                 <td><strong class="visible-xs">Registered</strong> {{ getDates($class->created_at) }} 
                                   @php 
                                    $divPenalty = getDivJoiningDatePanlety($class->pclass->id,$horses->horse_id);
                                  @endphp
                                  {!! $divPenalty['html'] !!}
                                 </td>
                                 <td><strong class="visible-xs">Price</strong>
                                  @if(isset($class->price)) ($){{twodecimalformate($class->price+$divPenalty['totalPenalty'])}} <?php $divisionTotal= $divisionTotal+$class->price+$divPenalty['totalPenalty']; ?> @else No Price Set. @endif
                                 </td>
                                
                              </tr>
                                <?php   
                              }
                              ?> 

                            </tbody>
                          </table>
                      </div>
                      <div class="Totals row">
                       <table class="col-sm-6 pull-right">
                         <tbody>
                           <tr>
                              <td class="border-bottom"><b> Division Price: </b></td>
                              <td class="border-bottom">($) {{$divisionTotal}}</td>
                           </tr>
                         </tbody>
                       </table>                                 
                      </div>
                  </div>
                  <br>
                    @php } @endphp

                      <!-- classes -->
                      <div class="classes-title">
                          @if($MS->template->category == TRAINER)
                              <h3>Training Services</h3>
                          @else
                              <h3>Classes</h3>
                          @endif

                          <div class="rr-datatable">
                              <table id="crudTabl" class="table primary-table">
                                <thead class="hidden-xs">
                                   <tr>
                                       @if($MS->template->category == TRAINER || $MS->template->category == HORSE )
                                           <th>Training Services</th>
                                           <th>Qty x Price</th>
                                       @else
                                       <th>Classes</th>
                                       <th>Code</th>
                                      <th># of Entries</th>
                                       <th>Penalty</th>
                                       @endif
                                      <th>Registered</th>
                                      <th width="18%">Price</th>
                                      <!-- <th>Date</th>
                                      <th>Location</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                  <?php 
                                  if ($invoice_status == 1) {
                                    $ListHorses = getPaidHorses($horses->horse_id,$show_id,$divisionClassesInc,$paid_on); 
                                  }else{
                                    $ListHorses = getUnPaidHorses($horses->horse_id,$show_id,$divisionClassesInc); 
                                  }

                                    if (count($ListHorses['collection'])>0) {
                                      foreach ($ListHorses['collection'] as $index => $class) {
                                        if ($class->pclass != null) {
                                  ?>
                                 <?php $JoiningPenalty=["html"=>"",'panelty'=>0]; $addedPenalty=["html"=>"",'panelty'=>0]; $sumPenalty =0; $horseCount=1;$classPenaltyLine = 0; $classPenalty =0;$scratchPenaltyLine =0;  $combinedClassId =0;?>

                                  <tr>
                                     <td><strong class="visible-xs">Class</strong> {{getAssetName($class->pclass)}} 
                                        @if(isset($class->combinedClass)) 
                                         @if(IsCSInShow($class->combinedClass->combined_class_id,$show_id) > 0)
                                          <strong>Combined Class</strong>
                                         @endif
                                        @php 
                                          $combinedClassId = $class->combinedClass->combined_class_id;
                                        @endphp
                                        @endif
                                        @if(isset($class->splitClass->splitedclass->SchedulerRestriction) 
                                            && count($class->splitClass->splitedclass->SchedulerRestriction)>0 ) 
                                         <strong>California Split</strong> 
                                        @endif
                                         @if(isset($class->qualifing_check) && $class->qualifing_price>0) 
                                         <strong>Qualifying Price:($){{$class->qualifing_price}}</strong> 
                                        @endif
                                  </td>
                                      @if($MS->template->category == TRAINER || $MS->template->category == HORSE)
                                          <td><strong class="visible-xs">Qty x Price</strong>
                                              {{$class->horse_quantity}} x {{$class->price}}</td>
                                      @endif
                                      @if($MS->template->category != TRAINER || $MS->template->category == HORSE)
                                      <td><strong class="visible-xs">Code</strong> {{ GetSpecificFormField($class->pclass,"Code") }} </td>
                                    <td><strong class="visible-xs"># of Entries </strong> {{getClassParticipants($class->class_id,$show_id,$combinedClassId)}} </td>
                                     <td><strong class="visible-xs">Penalty</strong>
                                      <?php
                                        if (count($class->Joining_penalty)>0) {
                                            $JoiningPenalty = getPenaltyImposed($class->Joining_penalty,$class->created_at,1);
                                            if ($JoiningPenalty['html'] != "") {
                                                    $classPenalty = $JoiningPenalty['panelty'];
                                                    $classPenaltyLine = $classPenaltyLine + $classPenalty;
                                                    $assetTotal = $assetTotal + $classPenalty;
                                            }
                                        }
                                    ?>
                                    {!! $JoiningPenalty['html'] !!}
                                    <?php if ($class->scratch==HORSE_SCRATCHED) {
                                                $horseCount =0;
                                                if (count($class->penalty)>0) {
                                                  $addedPenalty = getPenaltyImposed($class->penalty,$class->updated_at);
                                                  if ($addedPenalty['html'] != "") {
                                                    
                                                    $sumPenalty = $addedPenalty['panelty'];
                                                    $scratchPenaltyLine = $scratchPenaltyLine + $sumPenalty;
                                                    $assetTotal = $assetTotal + $sumPenalty;
                                                  }
                                                }
                                      ?>
                                        {!! $addedPenalty['html'] !!}
                                      <?php } ?>
                                     </td>

                                      @endif
                                      <td><strong class="visible-xs">Registered</strong> {{ getDates($class->created_at) }} </td>
                                     <td><strong class="visible-xs">Price</strong>


                                         @if($MS->template->category == TRAINER || $MS->template->category == HORSE)
                                         <span class="prise-contents">
                                              @if(isset($class->price))<span class="price-display"> 
                                                ($){{($class->price*$horseCount*$class->horse_quantity)+$classPenaltyLine+$scratchPenaltyLine }}</span>
                                                <?php $assetTotal = $assetTotal +($class->price*$horseCount*$class->horse_quantity); ?>
                                                <input type="hidden" class="priceSet" value="{{($class->price*$horseCount*$class->horse_quantity)+$classPenaltyLine+$scratchPenaltyLine}}">
                                              @else 
                                                <span class="price-display"> No Price Set.</span>
                                                <input type="hidden" class="priceSet" value="0"> 
                                              @endif 
                                            </span>
                                         @else
                                         <span class="prise-contents">
                                              @if(isset($class->price))<span class="price-display">
                                                ($){{($class->price*$horseCount)+$classPenaltyLine+$scratchPenaltyLine }}</span>
                                                 <?php $assetTotal = $assetTotal +($class->price*$horseCount); ?>
                                                 <input type="hidden" class="priceSet" value="{{($class->price*$horseCount)+$classPenaltyLine+$scratchPenaltyLine}}">
                                                 @else
                                                     <span class="price-display"> No Price Set.</span>
                                                     <input type="hidden" class="priceSet" value="0">
                                                 @endif
                                            </span>
                                         @endif

                                             <input type="hidden" class="ch_id" value="{{$class->id}}">
                
                                     </td>
                                     
                              
                                     <?php  
                                     //Split Charges , CH = ClassHorses
                                      $CHArray[]=$class->id;
                                      $paidONInvoice = $class->paid_on;
                                     //Additional Charges
                                     if (in_array($class->invite_asociated_key, array_column($additionalArray, 'invited_key') ) ) {
                                       //Due to change in requirements, Removed charges
                                       //echo "already have";
                                     }else{
                                            $additionalArray[$index]["ch_id"] = $class->id;
                                            $additionalArray[$index]["charges"] = $class->additional_charges;
                                            $additionalArray[$index]["divided"] = getInvoiceDividedUser($class->invite_asociated_key);
                                            $additionalArray[$index]["invited_key"] = $class->invite_asociated_key;
                                            $additionalArray[$index]["joined"] = getDates($class->created_at);
                                     }
                                      ?>
                                  </tr>
                                  <?php 
                                          } 
                                       }
                                    } 
                                  ?>

                                  <?php 
                                if(count($ListHorses['divClasses'])>0){
                                  foreach($ListHorses['divClasses'] as $class){
                                      if (!isset($index)) {
                                        $index = 0;
                                      }
                                      $index = $index+1;
                                      
                                      if (in_array($class->invite_asociated_key, array_column($additionalArray, 'invited_key') ) ) {
                                         //Due to change in requirements, Removed charges
                                         //echo "already have";
                                      }else{
                                          $additionalArray[$index]["ch_id"] = $class->id;
                                          $additionalArray[$index]["charges"] = $class->additional_charges;
                                          $additionalArray[$index]["divided"] = getInvoiceDividedUser($class->invite_asociated_key);
                                          $additionalArray[$index]["invited_key"] = $class->invite_asociated_key;
                                          $additionalArray[$index]["joined"] = getDates($class->created_at);
                                     }
                                    
                                  }
                                }
                                    
                              ?>
                                </tbody>
                              </table>
                          </div>
                          <div class="Totals row">
                               <table class="col-sm-6 pull-right">
                                 <tbody>
                                   <tr>
                                      <td class="border-bottom"><b> Total: </b></td>
                                      <td class="border-bottom">($) {{$assetTotal}}</td>
                                   </tr>
                                 </tbody>
                               </table>                                 
                              </div>
                           </div>
                      </div>
                      <br>
                      <div class="clear"></div>
                      <!-- Prize Money -->
                      @php 
                       $prizeWon=0;
                      @endphp 
                      @if(sizeof($prize)>0)
                      <div>
                      <h3>Prize Money</h3>
                      <div id="indivisual" class="">
                                <div class="module-holer rr-datatable">
                                <table id="crudTabl" class="table primary-table">
              <thead class="hidden-xs">
                 <tr>
                    <th style="width:5%">#</th>
                    <th>Class</th>
                    <th>Position</th>
                    <th>Prize Won</th>
                  </tr>
              </thead>
              <tbody>
                  <?php $serial =0; ?>
                      @foreach($prize as $one_asset)
                        <?php $decode_asset = json_decode($one_asset->position_fields); ?>
                        @foreach($decode_asset as $pResponse)
                          @if(isset($pResponse->horse_id) && $pResponse->horse_id == $horses->horse->id)
                           
                            @if($invoice_status == PAID)
                              @if(isset($pResponse->paid_on) && $pResponse->paid_on == $paid_on)
                                <tr class="tr-row">
                                  <td>@php $serial=1; @endphp</td>
                                  <td><strong class="visible-xs">Class</strong>{{GetAssetNamefromId($one_asset->asset_id)}}
                                     @if(isset($class->splitClass->splitedclass->SchedulerRestriction) 
                                        && count($class->splitClass->splitedclass->SchedulerRestriction)>0 ) 
                                     <strong>California Split</strong> 
                                    @endif
                                  </td>
                                  <td><strong class="visible-xs">Position</strong>@if(isset($pResponse->position)){!! getPostionText($pResponse->position) !!} @endif</td>
                                  <td><strong class="visible-xs">Price</strong>@if(isset($pResponse->price)) <div class="priceinqty"><?php $prizeWon = $prizeWon+$pResponse->price ?>($){{ $pResponse->price}}</div> @else No Price Set. @endif</td>
                                </tr>
                              @endif
                            @else
                              @if(!isset($pResponse->paid_on))
                            <?php  $serial = $serial + 1;?>
                            
                              <tr class="tr-row">
                                  <td>{{ $serial }}</td>
                                  <td><strong class="visible-xs">Class</strong>{{GetAssetNamefromId($one_asset->asset_id)}}
                                    @if(isset($class->splitClass->splitedclass->SchedulerRestriction) 
                                        && count($class->splitClass->splitedclass->SchedulerRestriction)>0 ) 
                                     <strong>California Split</strong> 
                                    @endif
                                  </td>
                                  <td><strong class="visible-xs">Position</strong>@if(isset($pResponse->position)){!! getPostionText($pResponse->position) !!} @endif</td>
                                  <td><strong class="visible-xs">Price</strong>@if(isset($pResponse->price) && !empty($pResponse->price)) <div class="priceinqty"><?php $prizeWon = $prizeWon+$pResponse->price ?>($){{ $pResponse->price}}</div> @else No Price Set. @endif</td>
                              </tr>
                              @endif
                            @endif
                          
                          @endif
                        @endforeach
                      @endforeach
                      @if($serial ==0)
                      <tr class="tr-row">
                        <td colspan="4"> You have not won any position or prize!</td>
                      </tr>
                      @endif
              </tbody>
          </table>
                           </div>

                           <div class="Totals row">
                               <table class="col-sm-6 pull-right">
                                 <tbody>
                                   <tr>
                                      <td class="border-bottom"><b> Prize Won: </b></td>
                                      <td class="border-bottom">($) {{$prizeWon}}</td>
                                   </tr>
                                 </tbody>
                               </table>                                 
                              </div>

                      </div>
                      </div>
                      @endif

                      


                      <!-- Split Charges. -->
                      <?php 
                        $splitPrice = 0;
                        $SpliteCharges = getSplitCharges($CHArray,$invoice_status,$paid_on); 
                      ?>
                    @if(sizeof($SpliteCharges)>0)
                     <div>
                      <h3>Split Charges by Trainer</h3>
                      <div id="indivisual" class="">
                                <div class="rr-datatable">
                                    <table id="crudTabl" class="table primary-table">
                                    <thead class="hidden-xs">
                                       <tr>
                                          <th>Title</th>
                                          <th>Description</th>
                                          <th>Date</th>
                                          <th>Trainer</th>
                                          <th width="30%">Qty x Price </th>
                                          <th width="8%">Split</th>
                                          <th>Price </th>
                                          <!-- <th>Date</th>
                                          <th>Location</th> -->
                                        </tr>
                                    </thead>
                                    <tbody>
                                            @foreach($SpliteCharges as $pSresponse)
                                                <?php 
                                                    if (isset($pSresponse->additional_fields)>0) {
                                                        $splite_additional = json_decode($pSresponse->additional_fields);
                                                    }else{
                                                        $splite_additional = null;
                                                    }

                                                ?>
                                              @if($splite_additional)
                                                @foreach($splite_additional as $pResponse)
                                                 @if(isset($pResponse->id))
                                                <tr class="tr-row additiona-charges-row">
                                                    
                                                    <td><strong class="visible-xs">Title</strong> {{AdditionalCharge($pResponse->id)}}</td>
                                                    <td><strong class="visible-xs">Description</strong>{{ AdditionalCharge($pResponse->id,1) }}</td>
                                                    <td><strong class="visible-xs">Date</strong>{{ getDates($pSresponse->created_at) }}</td>
                                                    <td><strong class="visible-xs">Trainer</strong>{{$pSresponse->TrainerUser->name}}</td>
                                                    <td><strong class="visible-xs">Price</strong>
                                                      <span class="additional-divi">
                                                        @if(isset($pResponse->price)) {{ $pResponse->qty}} x {{$pResponse->price }} = ($){{$pResponse->price*$pResponse->qty}} @else No Price Set. @endif
                                                      </span>
                                                        <input type="hidden" class="trainer-split" value="1"> 
                                                        <input type="hidden" class="additonal-price" value="{{$pResponse->price }}"> 
                                                        <input type="hidden" class="additonal-qty" value="{{ $pResponse->qty}}"> 
                                                        <input type="hidden" class="additional-split-id" value="{{$pSresponse->id}}"> 
                                                        <input type="hidden" class="additonal-row-id" value="{{$pResponse->id}}"> 
                                                        
                                                     
                                                  </td>
                                                  <td><strong class="visible-xs">Split</strong>{{$pSresponse->divided_amoung}}</td>

                                                    <td><strong class="visible-xs">Price</strong>
                                                      @if(isset($pResponse->price))
                                                        <div class="priceinqty">
                                                        <?php $lineVla =  ($pResponse->price*$pResponse->qty / $pSresponse->divided_amoung);
                                                                  $splitPrice =$splitPrice +$lineVla  ?>{{getpriceFormate($lineVla) }}</div> @else No Price Set. @endif
                                                      </td>
                                                </tr>
                                                @endif
                                                @endforeach
                                                @if(isset($pSresponse->comment) && $pSresponse->comment != "")
                                                  <tr>
                                                    <td >Comments for Above split:</td>
                                                    <td colspan="3">{{$pSresponse->comment}}</td>
                                                  </tr>
                                                @endif
                                              @endif
                                            @endforeach
                                    </tbody>
                                </table>
                           </div>
                           <div class="Totals row">
                               <table class="col-sm-6 pull-right">
                                 <tbody>
                                   <tr>
                                      <td class="border-bottom"><b> Split Charges: </b></td>
                                      <td class="border-bottom">($) {{twodecimalformate($splitPrice)}}<input type="hidden" class="splitcharges" name="Invoices[{{$horses->horse_id}}][split_charges]" value="{{$splitPrice}}"></td>
                                   </tr>
                                 </tbody>
                               </table>                                 
                            </div>
                            <br>

                      </div>
                      </div>
                     @endif

                      <!-- Additional Charges. -->
                        <div class="additional-charges">
                          <h3>Additional Charges</h3>
                          <div class="rr-datatable">
                              <table id="crudTabl" class="table primary-table">
                                <thead class="hidden-xs">
                                   <tr>
                                      <th>Title</th>
                                      <th>Date Register</th>
                                      <th>Description</th>
                                      <th width="30%">Qty x Price</th>
                                      <th width="8%">Divided</th>
                                      <th>Total Price</th>
                                      <!-- <th>Date</th>
                                      <th>Location</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                <?php  $additionalPrice=0;?>
                                  @if(!empty($additionalArray))
                                    @foreach($additionalArray as $allCharges)
                                      <?php 
                                        if (isset($allCharges["charges"])) {
                                           $charge = json_decode($allCharges["charges"]);
                                       ?>
                                      @if(count($charge)>0)
                                      @foreach($charge as $pResponse)
                                          @if(isset($pResponse->id))
                                          <?php if (!in_array($pResponse->id, $additionalExistingids)) {
                                              $additionalExistingids[] = $pResponse->id ?>
                                              
                                              <tr class="tr-row additiona-charges-row">
                                                  <td><strong class="visible-xs">Title</strong> {{AdditionalCharge($pResponse->id)}}</td>
                                                  <td><strong class="visible-xs">Date</strong> {{$allCharges["joined"]}}</td>
                                                  <td><strong class="visible-xs">Description</strong>{{ AdditionalCharge($pResponse->id,1) }}</td>
                                                  <td><strong class="visible-xs">Price</strong>
                                                      <span class="additional-divi">
                                                        @if(isset($pResponse->price)) {{ $pResponse->qty}} x {{$pResponse->price }} = ($){{$pResponse->price*$pResponse->qty}} @else No Price Set. @endif
                                                      </span>
                                                        <input type="hidden" class="additonal-price" value="{{$pResponse->price }}"> 
                                                        <input type="hidden" class="additonal-qty" value="{{ $pResponse->qty}}"> 
                                                        <input type="hidden" class="ch_id" value="{{$allCharges['ch_id']}}"> 
                                                        <input type="hidden" class="additonal-row-id" value="{{$pResponse->id}}"> 
                                                        
                                                     
                                                  </td>
                                                  
                                                  <td><strong class="visible-xs">Divided</strong>{{$allCharges["divided"]}}</td>
                                                  <td><strong class="visible-xs">Price</strong>@if(isset($pResponse->price)) <div class="priceinqty"><?php $additionalPrice = $additionalPrice + number_format((($pResponse->price*$pResponse->qty)/$allCharges["divided"]),2) ?>($){{ number_format((($pResponse->price*$pResponse->qty)/$allCharges["divided"]),2) }}</div> @else No Price Set. @endif</td>
                                              </tr>
                                              <?php } ?>
                                            @endif
                                        @endforeach
                                      @endif
                                      <?php } ?>
                                    @endforeach
                                  @else
                                    <tr class="tr-row additiona-charges-row">
                                       <td colspan="5"> No additional charges.</td>
                                    </tr>
                                  @endif


                                  @php
                                    $myOrderSuppliesobj=new stdClass();
                                    $myOrderSuppliesobj->suppliesPrice=$additionalPrice;
                                  @endphp
                                  @include('shows.billing.partials.orderedSupplies',['myOrderSuppliesobj'=>$myOrderSuppliesobj])
                                  @php $additionalPrice=$myOrderSuppliesobj->suppliesPrice @endphp
                                  
                                </tbody>
                              </table>
                          </div>
                      </div>
                      <!-- stall purchased. -->
                      @php 
                        $myStallobj=new stdClass();
                        $myStallobj->stallPrice=0;
                        $stallPrice = 0;
                      @endphp
                      @include('shows.billing.partials.stallprice',['myStallobj'=>$myStallobj])
                      @php $stallPrice=$myStallobj->stallPrice @endphp

                
                    </div>

                    <div class="Totalss">
                      @if(count($sponsers)>0)
                        <table style="clear:both;margin-left: 25px 0;">
                          <tr>
                          <td style="text-align: center;">
                          <b>
                            This show is sponsored by
                              <?php $i = 0; ?>
                              @foreach($sponsers as $sponsor)
                                @if(isset($sponsor->sponsor->fields))
                                  @if($i != 0)
                                   <span>,</span>
                                  @endif
                                  <strong class="brown">{{getFirstFieldAnswer($sponsor->sponsor)}} </strong> 
                                  <?php $i++; ?>
                                @endif
                              @endforeach
                            </b>
                            </td>
                          </tr>
                        </table>
                        <br>
                         <div class="clear-fix"></div>
                        @endif
                 <div class="">
                     <?php $commentG = getInvoiceAddedComment($show_id,$horses->horse_id); ?>
                    <table class="pull-right">
                           <tbody>
                     <tr>
                          <td class="border-bottom"><label>Comments: </label></td>
                          <td class="border-bottom">
                          @if(isset($commentG->comment))
                           <p>{{ nl2br(e($commentG->comment)) }}</p>
                          @else 
                            <p>No Comments</p>
                          @endif
                          </td>

                      </tr>
                      
                              <tr>
                                <td class="border-bottom"><b> Additional Pricing: </b></td>
                                <td class="border-bottom">
                                  ($) {{twodecimalformate($additionalPrice)}}<input type="hidden" class="additionalPrice" name="Invoices[{{$horses->horse_id}}][additional_price]" value="{{twodecimalformate($additionalPrice)}}">
                                </td>
                              </tr>

                              <tr>
                                  <?php
                                if($prizeWon < 600)
                                {
                                    $totalAmount = ($additionalPrice+$assetTotal+$divisionTotal+$stallPrice)-$prizeWon+$splitPrice;
                                }else{

                                    if(prizeClaimCount($horses->horse_id,$show_id) > 0)
                                        $totalAmount =  ($additionalPrice+$assetTotal+$divisionTotal+$stallPrice)-$prizeWon+$splitPrice;
                                    else
                                        $totalAmount = ($additionalPrice+$assetTotal+$divisionTotal+$stallPrice)+$splitPrice;
                                }
                                $royaltyFinal =twodecimalformate($totalAmount/100*$royalty);


                               ?>
                                <td class="border-bottom"><b> Miscellaneous Charges: </b></td>
                                <td class="border-bottom">($) {{$royaltyFinal}}
                                   <input type="hidden" class="royaltyPrice" name="Invoices[{{$horses->horse_id}}][royalty]" value="{{$royaltyFinal}}">
                                   <input type="hidden" class="royaltyByOwner" name="Invoices[{{$horses->horse_id}}][royaltyByOwner]" value="{{$royalty}}">
                                </td>
                              </tr>

                              <tr>

                                  @if($MS->template->category == TRAINER || $MS->template->category == HORSE)
                                  <td class="border-bottom"><b> (Classes+Additonal+Miscellaneous Charges+Division)-Prize: </b></td>
                                  <td class="border-bottom">($) ({{$assetTotal}} + {{twodecimalformate($additionalPrice)}}+{{$royaltyFinal}}+{{$divisionTotal}}) - {{$prizeWon}} = {{$total = twodecimalformate(($additionalPrice+$assetTotal+$royaltyFinal+$divisionTotal)-$prizeWon) }}</td>
                                  @else
                                  <td class="border-bottom"><b> (Classes+Additonal+Miscellaneous Charges+Division+Stall)-Prize: </b></td>
                                  <td class="border-bottom">($) ({{$assetTotal}} + {{twodecimalformate($additionalPrice)}}+{{$royaltyFinal}}+{{$divisionTotal}}+{{$stallPrice}}) - {{$prizeWon}} = {{$total = twodecimalformate(($additionalPrice+$assetTotal+$royaltyFinal+$divisionTotal+$stallPrice)-$prizeWon) }}</td>
                                  @endif
                              </tr>
                              @if(isset($splitPrice))
                                <tr>
                                  <td class="border-bottom"><b> Total + Split Charges: </b></td>
                                  <td class="border-bottom">($) {{$total}} + {{$splitPrice}} = {{twodecimalformate($total = $total+$splitPrice)}}</td>
                                </tr>
                              @endif
                              <tr>
                                <td class="border-bottom"><b>  (Federal + State Tax) + Total: </b></td>
                                <?php 
                                      $tfederal = $MS->federal_tax; 
                                      $tstate = $MS->state_tax; 
                                      $taxFederal = ($tfederal*$total)/100;
                                      $taxState = ($tstate*$total)/100;
                                  ?>
                                <td class="border-bottom">
                                    <input type="hidden" name="Invoices[{{$horses->horse_id}}][federal_tax]" value="{{$taxFederal}}">
                                    <input type="hidden" name="Invoices[{{$horses->horse_id}}][state_tax]" value="{{$taxState}}">
                                    ($) ( {{twodecimalformate($taxFederal)}} + {{twodecimalformate($taxState)}} ) + {{twodecimalformate($total)}} = {{twodecimalformate($total = $taxState+$taxFederal+$total)}}
                        
                                </td>
                              </tr>

                              <tr>
                                <td class="border-bottom"><b> Total: </b></td>
                                <td class="border-bottom">($) {{twodecimalformate($total)}} <input type="hidden" class="totalPrice" name="Invoices[{{$horses->horse_id}}][total_price]" value="{{twodecimalformate($total)}}"></td>
                              </tr>

                           </tbody>
                        </table> 
                          <input type="hidden" name="Invoices[{{$horses->horse_id}}][horse_id]" value="{{$horses->horse_id}}">
                          <input type="hidden" name="Invoices[{{$horses->horse_id}}][show_id]" value="{{$show_id}}">
                          
                        <br>
                        
                  </div>
                  
                
             </div>
                           

                </div>
                

              <div class="page-break"></div>
              @endforeach
            @else
              <p> No Invoice Paid</p>
            @endif


            </div>

<!-- Tab containing all the data tables -->
</div>
</div>
</body>
</html>